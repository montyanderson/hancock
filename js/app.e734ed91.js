(function(t){function e(e){for(var a,s,i=e[0],o=e[1],u=e[2],b=0,y=[];b<i.length;b++)s=i[b],Object.prototype.hasOwnProperty.call(c,s)&&c[s]&&y.push(c[s][0]),c[s]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);l&&l(e);while(y.length)y.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,i=1;i<n.length;i++){var o=n[i];0!==c[o]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},c={app:0},r=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],o=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=o;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},1:function(t,e){},4677:function(t,e,n){"use strict";n("91ea")},"4cc4":function(t,e,n){"use strict";n("dd30")},"91ea":function(t,e,n){},"93fb":function(t,e,n){},cd49:function(t,e,n){"use strict";n.r(e);var a=n("7a23");function c(t,e){const n=Object(a["x"])("router-view");return Object(a["q"])(),Object(a["d"])(n)}n("d148");var r=n("6b0d"),s=n.n(r);const i={},o=s()(i,[["render",c]]);var u=o,l=n("6c02");const b={class:"container"},y={class:"tracks"},d=["onDblclick"],f=["src"],p={key:1,class:"cover"},w={class:"title"},g={class:"artist"},j={class:"album"},O=Object(a["g"])("td",{class:"menu"},"...",-1);function m(t,e,n,c,r,s){const i=Object(a["x"])("currently-playing");return Object(a["q"])(),Object(a["f"])("div",b,[Object(a["g"])("table",y,[Object(a["g"])("tbody",null,[(Object(a["q"])(!0),Object(a["f"])(a["a"],null,Object(a["w"])(t.tracks,e=>(Object(a["q"])(),Object(a["f"])("tr",{onDblclick:n=>t.play(e)},[Object(a["g"])("td",null,[e.cover?(Object(a["q"])(),Object(a["f"])("img",{key:0,class:"cover",src:e.cover},null,8,f)):(Object(a["q"])(),Object(a["f"])("div",p))]),Object(a["g"])("td",w,Object(a["z"])(e.tags.title),1),Object(a["g"])("td",g,Object(a["z"])(e.tags.artist),1),Object(a["g"])("td",j,Object(a["z"])(e.tags.album),1),O],40,d))),256))])]),Object(a["h"])(i)])}var k=n("5502"),h=n("bdfb"),v=n("8a6c"),B=n("3a8e"),P=n("7808"),x=(t,e)=>{if(t!==e)throw new Error(`'${t}' !== '${e}'`)};const K=t=>[...t].map(t=>String.fromCharCode(t)).join("");var C,A=t=>{const e=131072;let n=0,a=new Uint8Array(0);const c=async c=>{while(a.length<n+c){const n=Math.max(c,e),r=await t(n,a.length);x(r.length,n),a=new Uint8Array([...a,...r])}};return{index:async()=>n,skip:async t=>{await c(t),n+=t},bytes:async t=>{await c(t);const e=a.slice(n,n+t);return n+=t,e},string:async t=>{await c(t);const e=K(a.slice(n,n+t));return n+=t,e},uint8:async()=>(await c(1),a[n++]),uint16:async()=>{await c(2);const t=a[n++],e=a[n++];return(t<<8)+e},uint24:async()=>{await c(3);const t=a[n++],e=a[n++],r=a[n++];return(t<<16)+(e<<8)+r},uint32:async()=>{await c(4);const t=a[n++],e=a[n++],r=a[n++],s=a[n++];return(s<<24)+(r<<16)+(e<<8)+t},uint32BE:async()=>{await c(4);const t=a[n++],e=a[n++],r=a[n++],s=a[n++];return(t<<24)+(e<<16)+(r<<8)+s}}};(function(t){t[t["VorbisComment"]=4]="VorbisComment",t[t["Picture"]=6]="Picture"})(C||(C={}));const E=async t=>{const e=t.getReader();let n=new Uint8Array(0);for(;;){const{value:t,done:a}=await e.read();if(a)break;n=new Uint8Array([...n,...t])}return n},T=async(t,e)=>{const n=async(n,a)=>{const{Body:c}=await t.send(new v["a"]({...e,Range:`bytes=${a}-${a+n-1}`}));return E(c)},a=A(n),c=await a.string(4);x(c,"fLaC");const r={};let s=null;const i=async()=>{const t=await a.uint8(),n=128,c=!!(t&n),i=t&~n;console.log(e.Key,{blockType:i,isLastBlock:c});const o=await a.uint24(),u=await a.index();switch(i){default:await a.skip(o);break;case C.VorbisComment:const t=await a.uint32(),e=(await a.string(t),await a.uint32());for(let s=0;s<e;s++){const t=await a.uint32(),e=await a.string(t),[n,c]=e.split("=");r[n.toLowerCase()]=c}break;case C.Picture:await a.uint32BE();const n=await a.uint32BE(),c=await a.string(n),i=await a.uint32BE(),u=(await a.string(i),await a.uint32BE(),await a.uint32BE(),await a.uint32BE(),await a.uint32BE(),await a.uint32BE()),l=new Uint8Array([...await a.bytes(u)]),b=await new Promise(t=>{const e=new FileReader;e.onloadend=()=>t(e.result),e.readAsDataURL(new Blob([l.buffer]))});if("string"!==typeof b)throw new Error("base64Url not string");s=`data:${c};base64,${b.split(",",2)[1]}`;break}return x(u+o,await a.index()),{blockType:i,isLastBlock:c}};while(!1===(await i()).isLastBlock);await Object(h["a"])(t,new v["a"]({...e}));return{path:e,tags:r,cover:s}},U=Symbol(),_=Object(k["a"])({state:{client:null,tracks:[],playing:null},getters:{trackUrl:t=>async e=>null===t.client?"":Object(h["a"])(t.client,new v["a"]({...e.path})),sortedTracks:t=>{const e=[...t.tracks];return e.sort((t,e)=>(console.log(t.tags),t.tags.artist>e.tags.artist?1:t.tags.artist<e.tags.artist?-1:t.tags.album>e.tags.album?1:t.tags.album<e.tags.album?-1:Number(t.tags.tracknumber)>Number(e.tags.tracknumber)?1:Number(t.tags.tracknumber)<Number(e.tags.tracknumber)?-1:0))}},mutations:{setClient:(t,e)=>{t.client=e},pushTrack:(t,e)=>{t.tracks.push(e)},setPlaying:(t,e)=>{t.playing=e}},actions:{index:async({commit:t},{accessKeyId:e,secretAccessKey:n,Bucket:a})=>{const c=new B["a"]({endpoint:"https://gateway.eu1.storjshare.io",region:"us-east-1",credentials:{accessKeyId:e,secretAccessKey:n}});async function*r(t,e=""){const n=await c.send(new P["a"]({Bucket:a}));if("undefined"!==typeof n.Contents)for(const{Key:c}of n.Contents)"string"===typeof c&&c.endsWith(t)&&(yield{Key:c,Bucket:a})}t("setClient",c);const s=[];(async()=>{for await(const t of r(".flac"))s.push(t)})(),(async()=>{const e=async()=>{const e=t=>new Promise(e=>setTimeout(e,t));while(0===s.length)await e(10);while(s.length){const e=s.shift();if("undefined"===typeof e)return;const n=await T(c,e);t("pushTrack",n)}},n=4;for(let t=0;t<n;t++)e()})()},play:({commit:t},e)=>{t("setPlaying",e)}},modules:{}});function q(){return Object(k["b"])(U)}const S={key:0,class:"player"},I={class:"player-container"},L=["src"],$={class:"title"},z={class:"artist"},M=["src"];function N(t,e,n,c,r,s){return null!==t.track?(Object(a["q"])(),Object(a["f"])("div",S,[Object(a["g"])("div",I,[Object(a["g"])("img",{class:"player-cover",src:t.track.cover},null,8,L),Object(a["g"])("p",$,Object(a["z"])(t.track.tags.title),1),Object(a["g"])("p",z,Object(a["z"])(t.track.tags.artist),1),Object(a["g"])("audio",{controls:"",src:t.url,autoplay:""},null,8,M)])])):Object(a["e"])("",!0)}var R=Object(a["i"])({name:"Player",setup:()=>{const t=q(),e=Object(a["b"])(()=>t.state.playing),n=Object(a["v"])("");return Object(a["B"])(e,async()=>{n.value=await t.getters.trackUrl(e.value)}),{track:e,url:n}}});n("4677");const D=s()(R,[["render",N],["__scopeId","data-v-398c7707"]]);var V=D,H=Object(a["i"])({name:"Home",setup:()=>{const t=Object(l["c"])(),{accessKeyId:e,secretAccessKey:n,Bucket:c}=t.params,r=q();r.dispatch("index",{accessKeyId:e,secretAccessKey:n,Bucket:c});const s=Object(a["b"])(()=>r.getters.sortedTracks),i=t=>{r.dispatch("play",t)};return{tracks:s,play:i}},components:{CurrentlyPlaying:V}});n("4cc4");const J=s()(H,[["render",m]]);var F=J;const W=[{path:"/:accessKeyId/:secretAccessKey/:Bucket",name:"Home",component:F}],G=Object(l["a"])({history:Object(l["b"])(),routes:W});var Q=G;Object(a["c"])(u).use(_,U).use(Q).mount("#app")},d148:function(t,e,n){"use strict";n("93fb")},dd30:function(t,e,n){}});
//# sourceMappingURL=app.e734ed91.js.map